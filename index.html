<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Precificação</title>
  <meta name="description" content="Calcule preço sugerido, markup, margem de contribuição e lucro por unidade." />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-gray-50 to-white text-gray-900">
  <main class="mx-auto max-w-5xl px-4 py-10">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">Calculadora de Precificação</h1>
      <a href="#" class="rounded-full bg-gray-900 px-4 py-2 text-sm font-semibold text-white hover:bg-gray-800">Quero dominar a precificação</a>
    </div>

    <div class="grid gap-6 md:grid-cols-2">
      <!-- ENTRADAS -->
      <section class="rounded-2xl border bg-white p-6 shadow-sm">
        <h2 class="mb-4 text-lg font-semibold">Entradas</h2>

        <div class="mb-4">
          <label for="custo" class="mb-1 block text-sm font-medium">Custo unitário (R$)</label>
          <input id="custo" type="number" inputmode="decimal" min="0" step="any"
                 class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2"
                 placeholder="Ex.: 50,00" />
        </div>

        <div class="mb-4 grid grid-cols-2 gap-4">
          <div>
            <label for="impostos" class="mb-1 block text-sm font-medium">Impostos (% do preço)</label>
            <input id="impostos" type="number" inputmode="decimal" min="0" step="any"
                   class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2"
                   value="0" placeholder="0" />
          </div>

          <div>
            <label for="taxas" class="mb-1 block text-sm font-medium">Taxas/Cartão (% do preço)</label>
            <input id="taxas" type="number" inputmode="decimal" min="0" step="any"
                   class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2"
                   value="0" placeholder="0" />
          </div>
        </div>

        <div class="mb-4 grid grid-cols-2 gap-4">
          <div>
            <label for="comissao" class="mb-1 block text-sm font-medium">Comissão (% do preço)</label>
            <input id="comissao" type="number" inputmode="decimal" min="0" step="any"
                   class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2"
                   value="0" placeholder="0" />
          </div>

          <div>
            <label for="margem" class="mb-1 block text-sm font-medium">Margem de lucro desejada (% do preço)</label>
            <input id="margem" type="number" inputmode="decimal" min="0" step="any"
                   class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2"
                   value="0" placeholder="0" />
          </div>
        </div>

        <div class="mb-4">
          <label for="fixos" class="mb-1 block text-sm font-medium">Custos fixos mensais (R$) — opcional</label>
          <input id="fixos" type="number" inputmode="decimal" min="0" step="any"
                 class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2"
                 placeholder="Para calcular o ponto de equilíbrio" />
        </div>

        <button id="btnLimpar" type="button"
                class="rounded-xl border bg-white px-4 py-2 text-sm font-medium hover:bg-gray-50">
          Limpar
        </button>
      </section>

      <!-- RESULTADOS -->
      <section class="rounded-2xl border bg-white p-6 shadow-sm">
        <h2 class="mb-4 text-lg font-semibold">Resultados</h2>

        <div class="mb-4 grid gap-3">
          <div class="rounded-xl border p-3">
            <p class="text-xs text-gray-500">Preço sugerido</p>
            <p id="preco" class="text-xl font-semibold">R$ 0,00</p>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Markup</p>
              <p id="markup" class="text-lg font-semibold">0.00x</p>
            </div>
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Lucro por unidade</p>
              <p id="lucro" class="text-lg font-semibold">R$ 0,00</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Margem de contribuição</p>
              <p id="mc_valor" class="text-lg font-semibold">R$ 0,00</p>
            </div>
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Margem de contribuição %</p>
              <p id="mc_perc" class="text-lg font-semibold">0.0%</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Impostos (R$)</p>
              <p id="imp_val" class="text-lg font-semibold">R$ 0,00</p>
            </div>
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Taxas/Cartão (R$)</p>
              <p id="tax_val" class="text-lg font-semibold">R$ 0,00</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Comissão (R$)</p>
              <p id="com_val" class="text-lg font-semibold">R$ 0,00</p>
            </div>
            <div class="rounded-xl border p-3">
              <p class="text-xs text-gray-500">Custos variáveis (R$)</p>
              <p id="variaveis" class="text-lg font-semibold">R$ 0,00</p>
            </div>
          </div>

          <div class="rounded-xl border p-3">
            <p class="text-xs text-gray-500">Ponto de equilíbrio (unid./mês)</p>
            <p id="pe" class="text-lg font-semibold">—</p>
          </div>
        </div>

        <p class="mt-4 text-xs text-gray-500">
          Fórmula: Preço = Custo / (1 - (Impostos% + Taxas% + Comissão% + Margem%)).<br />
          Margem informada = lucro líquido desejado sobre o preço.
        </p>
      </section>
    </div>
  </main>

  <script>
    // Util
    const money = (v) => (isFinite(v) ? v : 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    const pct   = (v) => `${(isFinite(v) ? v : 0).toFixed(1)}%`;
    const val   = (id) => {
      const el = document.getElementById(id);
      if (!el) return 0;
      const s = String(el.value || '').replace('.', '').replace(',', '.');
      const n = parseFloat(s);
      return isFinite(n) ? n : 0;
    };

    function recalc() {
      const custo = val('custo');
      const pImp  = val('impostos');
      const pTax  = val('taxas');
      const pCom  = val('comissao');
      const pMar  = val('margem');
      const fixos = val('fixos');

      const somaP = pImp + pTax + pCom + pMar;

      let preco = 0, impV=0, taxV=0, comV=0, lucro=0, variaveis=0, markup=0, pe = '—';

      if (custo > 0 && somaP < 100) {
        preco = custo / (1 - somaP/100);
        impV  = preco * pImp/100;
        taxV  = preco * pTax/100;
        comV  = preco * pCom/100;
        lucro = preco * pMar/100;               // lucro líquido desejado
        variaveis = preco - lucro;              // custo + variáveis
        markup = preco / custo;

        if (fixos > 0 && lucro > 0) {
          pe = Math.ceil(fixos / lucro).toLocaleString('pt-BR');
        }
      }

      // Preenche UI
      document.getElementById('preco').textContent     = money(preco);
      document.getElementById('markup').textContent    = `${isFinite(markup) ? markup.toFixed(2) : '0.00'}x`;
      document.getElementById('lucro').textContent     = money(lucro);
      document.getElementById('mc_valor').textContent  = money(lucro);
      document.getElementById('mc_perc').textContent   = pct(pMar);
      document.getElementById('imp_val').textContent   = money(impV);
      document.getElementById('tax_val').textContent   = money(taxV);
      document.getElementById('com_val').textContent   = money(comV);
      document.getElementById('variaveis').textContent = money(variaveis);
      document.getElementById('pe').textContent        = pe;
    }

    // Eventos
    ['custo','impostos','taxas','comissao','margem','fixos'].forEach(id => {
      const el = document.getElementById(id);
      el && el.addEventListener('input', recalc);
    });

    document.getElementById('btnLimpar').addEventListener('click', () => {
      ['custo','impostos','taxas','comissao','margem','fixos'].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.value = (id === 'impostos' || id === 'taxas' || id === 'comissao' || id === 'margem') ? '0' : '';
      });
      recalc();
    });

    // Cálculo inicial
    recalc();
  </script>

  <!-- Reset garantido: se vier com valores padrão indesejados, zera -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const els = [
        document.getElementById('impostos'),
        document.getElementById('taxas'),
        document.getElementById('margem'),
      ].filter(Boolean);

      els.forEach(el => {
        if (['', '10', '3', '20'].includes(String(el.value).trim())) {
          el.value = '0';
        }
      });

      // recalcula após o reset
      (typeof recalc === 'function') && recalc();
    });
  </script>
</body>
</html>
