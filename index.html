<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Precificação</title>
  <meta name="description" content="Calcule preço sugerido, markup, margem de contribuição e ponto de equilíbrio."/>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-gray-50 to-white text-gray-900">
  <main class="mx-auto max-w-3xl px-4 py-10">
    <header class="mb-8 text-center">
      <h1 class="text-2xl font-bold">Calculadora de Precificação</h1>
      <p class="mt-2 text-sm text-gray-600">Preencha os campos e veja os resultados na hora.</p>
    </header>

    <section class="rounded-2xl border bg-white p-6 shadow-sm grid gap-6">
      <div class="grid gap-4 sm:grid-cols-2">
        <label class="grid gap-1">
          <span class="text-sm font-medium">Custo unitário (R$)</span>
          <input id="custo" class="rounded-xl border px-3 py-2 outline-none focus:ring-2" placeholder="ex: 50,00" />
        </label>

        <label class="grid gap-1">
          <span class="text-sm font-medium">Despesas variáveis (% do preço)</span>
          <input id="dv" class="rounded-xl border px-3 py-2 outline-none focus:ring-2" placeholder="ex: 15 (taxas, impostos...)" />
        </label>

        <label class="grid gap-1">
          <span class="text-sm font-medium">Lucro desejado (% do preço)</span>
          <input id="lucro" class="rounded-xl border px-3 py-2 outline-none focus:ring-2" placeholder="ex: 20" />
        </label>

        <label class="grid gap-1">
          <span class="text-sm font-medium">Despesas fixas mensais (R$)</span>
          <input id="df" class="rounded-xl border px-3 py-2 outline-none focus:ring-2" placeholder="ex: 5000" />
        </label>

        <label class="grid gap-1 sm:col-span-2">
          <span class="text-sm font-medium">Volume mensal estimado (unid/mês)</span>
          <input id="volume" class="rounded-xl border px-3 py-2 outline-none focus:ring-2" placeholder="ex: 300" />
        </label>
      </div>

      <div id="erro" class="hidden rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"></div>

      <div class="grid gap-4 sm:grid-cols-2">
        <div class="rounded-xl border bg-gray-50 p-4">
          <p class="text-xs text-gray-500">Preço sugerido</p>
          <p id="preco" class="text-2xl font-semibold">R$ 0,00</p>
        </div>
        <div class="rounded-xl border bg-gray-50 p-4">
          <p class="text-xs text-gray-500">Markup</p>
          <p id="markup" class="text-2xl font-semibold">0,00x</p>
        </div>
        <div class="rounded-xl border bg-gray-50 p-4">
          <p class="text-xs text-gray-500">Margem de contribuição (R$)</p>
          <p id="mcUn" class="text-2xl font-semibold">R$ 0,00</p>
        </div>
        <div class="rounded-xl border bg-gray-50 p-4">
          <p class="text-xs text-gray-500">Margem de contribuição (%)</p>
          <p id="mcPct" class="text-2xl font-semibold">0,00%</p>
        </div>
        <div class="rounded-xl border bg-gray-50 p-4">
          <p class="text-xs text-gray-500">Ponto de equilíbrio (unid/mês)</p>
          <p id="pe" class="text-2xl font-semibold">0</p>
        </div>
        <div class="rounded-xl border bg-gray-50 p-4">
          <p class="text-xs text-gray-500">Lucro estimado p/ volume</p>
          <p id="lucroMes" class="text-2xl font-semibold">R$ 0,00</p>
        </div>
      </div>

      <div class="text-center">
        <a href="https://negocionocomando.github.io/calculadora-site/"
           class="text-sm text-gray-700 underline">Voltar</a>
      </div>
    </section>

    <p class="mt-6 text-center text-xs text-gray-500">
      © 2025 Negócio no Comando
    </p>
  </main>

  <script>
    // Helpers
    const toNum = (v) => {
      if (typeof v !== 'string') return Number(v) || 0;
      return Number(v.replace(/\./g,'').replace(',','.')) || 0;
    };
    const moeda = (n) => n.toLocaleString('pt-BR', { style:'currency', currency:'BRL' });
    const pct    = (n) => (n*100).toLocaleString('pt-BR', { maximumFractionDigits:2 }) + '%';
    const round2 = (n) => Math.round((n + Number.EPSILON) * 100) / 100;

    // Campos
    const $ = (id) => document.getElementById(id);
    const inputs = ['custo','dv','lucro','df','volume'].map($);

    function recalcular(){
      const custo  = toNum($('custo').value);
      const dv     = toNum($('dv').value) / 100;     // despesas variáveis (% do preço)
      const lucro  = toNum($('lucro').value) / 100;  // lucro desejado (% do preço)
      const df     = toNum($('df').value);           // despesas fixas mensais (R$)
      const volume = toNum($('volume').value);       // volume mensal estimado

      const boxErro = $('erro');
      boxErro.classList.add('hidden'); boxErro.textContent = '';

      if (dv + lucro >= 1){
        boxErro.textContent = 'A soma de Despesas variáveis (%) + Lucro desejado (%) deve ser menor que 100%.';
        boxErro.classList.remove('hidden');
        render(0,0,0,0,0,0);
        return;
      }
      if (custo <= 0){
        render(0,0,0,0,0,0);
        return;
      }

      // Fórmulas
      const preco = round2( custo / (1 - dv - lucro) );          // preço sugerido
      const markup = round2(preco / custo);                      // markup (x)
      const mcUn = round2(preco*(1 - dv) - custo);               // margem de contribuição unitária (R$)
      const mcPct = (preco > 0) ? mcUn / preco : 0;              // margem de contribuição %
      const pe = (mcUn > 0 && df > 0) ? Math.ceil(df / mcUn) : 0;// ponto de equilíbrio (unidades)
      const lucroMes = round2(mcUn * volume - df);               // lucro estimado

      render(preco, markup, mcUn, mcPct, pe, lucroMes);
    }

    function render(preco, markup, mcUn, mcPct, pe, lucroMes){
      $('preco').textContent  = moeda(preco);
      $('markup').textContent = markup.toLocaleString('pt-BR', { maximumFractionDigits:2 }) + 'x';
      $('mcUn').textContent   = moeda(mcUn);
      $('mcPct').textContent  = pct(mcPct);
      $('pe').textContent     = (pe||0).toLocaleString('pt-BR');
      $('lucroMes').textContent = moeda(lucroMes);
    }

    inputs.forEach(el => el.addEventListener('input', recalcular));
    // valores exemplo
    $('custo').value  = '50,00';
    $('dv').value     = '15';
    $('lucro').value  = '20';
    $('df').value     = '5000';
    $('volume').value = '300';
    recalcular();
  </script>
</body>
</html>
